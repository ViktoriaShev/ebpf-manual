
```c
if ((tcp_flags & 0x3F) != 0x02) {
	bpf_printk("Not SYN. flags=0x%x", tcp_flags);
	return XDP_PASS;
}
```

---

#### Почему именно так:

- `tcp_flags & 0x3F` — маска для всех шести TCP-флагов:
    
    - FIN = 0x01
    - SYN = 0x02
    - RST = 0x04
    - PSH = 0x08
    - ACK = 0x10
    - URG = 0x20  
        → Итого: `0x3F` = `0011 1111` — все 6 флагов.
    
- `!= 0x02` — оставляем только те, у которых **только SYN** (`0000 0010`) установлен, всё остальное — игнорируем (PASS).
    

---

#### Почему именно SYN?

- В TCP трёхэтапном рукопожатии (3-way handshake):
    
    1. Клиент отправляет `SYN`
    2. Сервер отвечает `SYN+ACK`
    3. Клиент отправляет `ACK`

 Таким образом, **SYN** — это **запрос клиента на попытку подключения**. И программа фильтрует такие пакеты, чтобы **блокировать соединения с определённых IP:портов** на этом этапе.
